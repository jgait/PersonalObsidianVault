Based on: [[VST_Paper_Process]]
### Specifications Section
The VST 2.0 achieves it's functionality by combining multiple subsystems into one complex device. Important subsystems that comprise the VST 2.0 include the variable stiffness module (VSM), the dynamic platforms, the split belt treadmill and drive system, the electrical and control system, the counterweights, the force mats, the motion capture system, and the body weight support. Through meticulous planning and design, the VST 2.0 integrates these disparate components to form a cohesive whole, the specifications of which are discussed in the following sections.

Design of the VST 2.0 began with defining the constraints and specifications for the system. The first set of specifications involve the variable stiffness capabilities and revolved around high level features, as well as stiffness and motion ranges. In order to have the ability to apply stiffness perturbations to either leg, the VST2.0 was designed to be bi-compliant with independently adjustable stiffnesses for each leg. The HORCLab VST 1.0, which preceded the VST 2.0, was only capable of variable stiffness on the \J{left leg?}. The upgrade to bi-compliance expands gait research possibilities and allows for testing a host of new hypothesis. To select a stiffness range for the VST 2.0, the stiffness values used gait research work were examined. This informed the selection of a 1 MN/m to 10 kN/m stiffness range, which allows for simulating a variety of surfaces from effectively rigid at 1 MN/m to very soft at 10 kN/m. In order to minimally disrupt the gait of a subject during testing, the deflection of the treadmill platforms as they are loaded was designed to be linear as opposed to angular \J{Add something comparing it to angular deflection on the VST1?}. Specifically, the system was designed with 10 cm of linear travel, giving it the capacity to handle a 100 kg individual walking at a stiffness of 10 kN/m without bottoming out. The system was designed with a high stiffness adjustment resolution (\J{Insert low res number} to \J{Insert high res number}) and a maximum stiffness set time of 0.08 seconds in order to permit precise and rapid stiffness changes.

The second set of specifications pertain to the split belt treadmill component of the VST 2.0. To accommodate a range of walking speeds, the treadmill was designed for a velocity range of -2.6 m/s to 2.6 m/s on each belt. Additionally, as variations in belt speed are an existing gait perturbation method used in prior work, the VST 2.0 was designed with independently variable belt speed and a velocity resolution of \J{Insert Velocity Resolution}. To ensure subject safety and comfort, the treadmill step-up height must be as small as possible, and so was designed to be \J{#Insert step-up height}. The treadmill belt width and length were designed to minimally modify the gait of subjects and accommodate the stride length of tall individuals, with the belt width being \J{Insert Width} and the length being \J{Insert length}. Additionally, the inter-belt distance was minimized and is designed to be less than 2 cm on the final system. The VST 2.0 also features force sensors beneath each belt to measure ground reaction forces of both feet throughout the stance phase, as well as encoders that measure the linear displacement of each platform during experiments. 

### Control Architecture Section
Control of the VST 2.0 begins at the control computer, an intel machine running Windows 10. The computer runs a python based control program and GUI \J{(Insert Figure Num for GUI photo)} that  handles all the VST control and allows for setting the stiffness and belt velocity of both sides of the VST. When a new stiffness is requested ($k_e^d$), the program computes the necessary VSM carriage position ($L_{CD}^d$) via function G1 (\J{Insert Eqn Num}) and sends it to the motor drivers via a USB serial connection. This compute-send process has a maximum update frequency of 300hz; however, in practice this operation is only performed a maximum of a few times per gait cycle, requiring a maximum frequency of just 5hz, well below the capabilities of the system. The motor drivers used in the VST 2.0 are Odrive v3.6 motor controllers, a popular closed-loop BLDC motor driver and active open-source project. When the motor drivers receive a new VSM carriage position, the drivers immediately attempt to move the motor to the target position according to the path created by a configurable trapezoidal trajectory planner. Beneath the trajectory planner, the drivers run a nested position-velocity-current control loop that performs closed loop position control at a frequency of 8kHz, providing very accurate and consistent position control with zero steady state position error. Each VSM is powered by a 2450 watt BLDC out runner motor. The motor drivers feed the VSM motors with 48v and anywhere up to 50A of phase current, resulting in a peak theoretical power consumption of 2.4 kW. Connected to each motor is a 8192 count per rotation encoder which provides position feedback to the Odrive motor drivers in order to close the motor control loop. When the motor arrives at its destination, the target carriage position ($L_{CD}$) is achieved, and the platform has a certain deflection according to the force applied and the effective stiffness. This deflection ($L_{GD}$) is measured by the displacement encoders integrated into the counterweight system which provide feedback on the platform displacement at a frequency of 100hz. The applied force ($F_f$) is also measured at the same time at a rate of 100hz by the force sensing mats beneath each belt. The final effective stiffness is a function of the kinematics and dynamics of the system and dependent upon the applied force ($F_f$) and the platform deflection ($L_{GD}$). This relationship is captured by function G2, which outputs the effective stiffness of the system for a given applied force and platform displacement. Overall, the stiffness control system is open-loop, with no feedback on the actual effective stiffness being used to optimize the performance of the system. This does open up the possibility for discrepancies between the true effective stiffness and desired effective stiffness, however, since the effective stiffness is only a function of the carriage position, any error could be \J{mitigated/eliminated (We will need to change this section a bit based on the results of our calibration)} by calibrating the VSM controller using experimental data. The VSM performance and calibration process will be discussed in the following section. 

The treadmill belts are controlled in a very similar way to the VSM, with the primary difference being that the treadmills utilize velocity control as opposed to position control. When a new linear velocity is set in the control program, the computer calculates the needed angular velocity at the motor and sends it to the Odrive motor drivers via USB serial connection. The motor drivers, which are running closed-loop velocity control on the belt motors at a loop frequency of 8kHz, then drive the belt motors to the desired velocity using 48v and anywhere up to 100A of current. As with the VSM motors, feedback is provided to the motor drivers by an 8192 count per rotation encoder connected to each belt motor. Unlike the VSM control system which has no feedback based on the true effective stiffness, the treadmill belt velocity control is fully closed loop and thus creates a very robust and accurate treadmill system.